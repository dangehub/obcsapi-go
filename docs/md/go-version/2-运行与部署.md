### 部署说明

下载 releases 提供的包，复制 config.examples.yaml 为 config.yaml ，修改账户密码和其他配置，然后在 Linux 环境运行 server 文件。如果是云函数环境，可以参考和运行 fc-run.sh ，进行部署。


部署方法

1. 拉取项目，构建部署
2. Docker 部署
3. 阿里云云函数 FC 运行构建的程序或 Docker

#### 构建 server

```bash
cd server/
go run .
go build -o server  -ldflags '-linkmode "external" -extldflags "-static"' .
```

#### Docker

```sh
# 构建镜像
docker build -t kkbt/obcsapi:v4.2.3 . 
# 运行 Docker
docker run -d -p 8900:8900 --name myObcsapi4.2.3 -v /home/kkbt/app/obcsapi-go/:/app/data/ kkbt/obcsapi:v4.2.3
# 或者通过 cp 方式修改好的 config.yaml
docker cp config.yaml myObcsapi4.2.3:/app/data/config.yaml
docker restart myObcsapi4.2.3
```
如果 -v 后文件出现没有权限访问的问题，可在宿主机执行 `sudo chmod 777 -R /home/kkbt/app/obcsapi-go/` 。

#### 云函数部署

用于阿里云云函数部署 由于自然分词（按 full 词典）等原因 实例刚刚创建时，巅峰内存为 300Mb + ，平时运行也在 200Mb +。可以通过选择更小的分词词典，减少内存。最低约 17Mb 。但是分词效果就并不好了。

下载 releases 压缩包，修改其中配置文件。选择 Go 或 Linux 环境，运行程序填写 `bash fc-run.sh`。

阿里云云函数选择挂载 OSS 时，如挂载到 函数计算`/app/` 目录。需要先将压缩包内除了 server config.yaml fc-run.sh 剩余文件放到 OSS 相应目录中。

截止 2023 04 09 阿里云云函数不支持 webdav 一些方法，所以无法使用 Wevdav 服务。